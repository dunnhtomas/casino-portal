# =============================================================================
# SECURITY HEADERS CONFIGURATION - BestCasinoPortal
# =============================================================================
# Priority: CRITICAL - Deploy Immediately
# Created: 2025-11-26
# Purpose: Add missing security headers identified in production audit
# =============================================================================

# -----------------------------------------------------------------------------
# HSTS - HTTP Strict Transport Security (CRITICAL)
# Forces HTTPS for 1 year, includes subdomains, enables HSTS preload list
# Risk Mitigation: Prevents man-in-the-middle attacks and protocol downgrade
# -----------------------------------------------------------------------------
add_header Strict-Transport-Security "max-age=31536000; includeSubDomains; preload" always;

# -----------------------------------------------------------------------------
# Content Security Policy (CRITICAL)
# Prevents XSS attacks by controlling which resources can be loaded
# Risk Mitigation: Blocks injection of malicious scripts
# -----------------------------------------------------------------------------
# CSP Policy breakdown:
#   default-src 'self'          - Only load resources from same origin by default
#   script-src                  - Scripts: self + analytics + inline (required for Astro)
#   style-src                   - Styles: self + inline + Google Fonts
#   img-src                     - Images: self + data URIs + any HTTPS
#   font-src                    - Fonts: self + Google Fonts
#   connect-src                 - AJAX/WebSocket: self + analytics
#   frame-src                   - Iframes: self + game embeds
#   frame-ancestors             - Who can embed us: same origin only
# -----------------------------------------------------------------------------
add_header Content-Security-Policy "default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://www.googletagmanager.com https://www.google-analytics.com https://cdn.jsdelivr.net https://static.cloudflareinsights.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; img-src 'self' data: https: http:; font-src 'self' https://fonts.gstatic.com data:; connect-src 'self' https://www.google-analytics.com https://analytics.google.com; frame-src 'self' https:; frame-ancestors 'self';" always;

# -----------------------------------------------------------------------------
# Referrer-Policy (MEDIUM)
# Controls how much referrer information is sent with requests
# Risk Mitigation: Prevents leaking sensitive URLs to third parties
# -----------------------------------------------------------------------------
add_header Referrer-Policy "strict-origin-when-cross-origin" always;

# -----------------------------------------------------------------------------
# Permissions-Policy (MEDIUM)
# Restricts browser features like camera, microphone, geolocation
# Risk Mitigation: Prevents malicious scripts from accessing sensitive APIs
# -----------------------------------------------------------------------------
add_header Permissions-Policy "camera=(), microphone=(), geolocation=(), payment=(), usb=(), magnetometer=(), gyroscope=(), accelerometer=()" always;

# -----------------------------------------------------------------------------
# EXISTING HEADERS (Already Present - Keep These)
# -----------------------------------------------------------------------------
# These are already configured but included for completeness
add_header X-Content-Type-Options "nosniff" always;
add_header X-Frame-Options "SAMEORIGIN" always;
add_header X-XSS-Protection "1; mode=block" always;

# -----------------------------------------------------------------------------
# ADDITIONAL SECURITY IMPROVEMENTS (Optional but Recommended)
# -----------------------------------------------------------------------------
# Hide nginx version
server_tokens off;

# Prevent caching of sensitive pages
# add_header Cache-Control "no-store, no-cache, must-revalidate, proxy-revalidate, max-age=0" always;

# Cross-Origin policies for additional protection
add_header Cross-Origin-Opener-Policy "same-origin" always;
add_header Cross-Origin-Resource-Policy "same-origin" always;
add_header Cross-Origin-Embedder-Policy "require-corp" always;

# =============================================================================
# INSTALLATION INSTRUCTIONS
# =============================================================================
#
# Option 1: Include in main nginx.conf
#   http {
#       include /etc/nginx/conf.d/security-headers.conf;
#       ...
#   }
#
# Option 2: Include in site-specific config
#   server {
#       include /etc/nginx/snippets/security-headers.conf;
#       ...
#   }
#
# Option 3: Copy headers directly into server block
#   Copy lines 14-57 into your server {} block
#
# AFTER INSTALLATION:
#   1. Test config:    sudo nginx -t
#   2. Reload nginx:   sudo systemctl reload nginx
#   3. Verify headers: curl -I https://bestcasinoportal.com
#
# =============================================================================

