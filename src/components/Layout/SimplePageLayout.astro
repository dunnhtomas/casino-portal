---
import HeaderNavigation from './HeaderNavigation.astro';
import FooterSection from './FooterSection.astro';
import BreadcrumbNavigation from './BreadcrumbNavigation.astro';
import AnalyticsHead from './AnalyticsHead.astro';

// Import main CSS
import '../../styles/main.css';

/**
 * Content Security Policy for static builds
 * This meta tag serves as a fallback when middleware CSP headers aren't applied
 */
const CSP_META_CONTENT = [
  "default-src 'self'",
  "script-src 'self' 'unsafe-inline' 'unsafe-eval' https://www.googletagmanager.com https://www.google-analytics.com https://cdn.jsdelivr.net https://static.cloudflareinsights.com",
  "script-src-elem 'self' 'unsafe-inline' https://www.googletagmanager.com https://www.google-analytics.com https://cdn.jsdelivr.net https://static.cloudflareinsights.com",
  "style-src 'self' 'unsafe-inline' https://fonts.googleapis.com",
  "img-src 'self' data: https: http:",
  "font-src 'self' https://fonts.gstatic.com data:",
  "connect-src 'self' https://www.google-analytics.com https://api.brandfetch.com https://cloudflareinsights.com",
  "frame-src 'self' https://playin.games https://game-providers.com",
  "object-src 'none'",
  "base-uri 'self'",
  "form-action 'self'",
  "upgrade-insecure-requests"
].join('; ');

interface Props {
  title: string;
  description: string;
  breadcrumbs?: { label: string; href: string }[];
}

const { title, description, breadcrumbs } = Astro.props;
---

<!DOCTYPE html>
<html lang="en" class="overflow-x-hidden">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, user-scalable=yes" />
    <title>{title}</title>
    <meta name="description" content={description} />

    <!-- Content Security Policy (Meta Tag Fallback for Static Builds) -->
    <!-- Primary CSP is enforced via HTTP headers in middleware for SSR/Hybrid builds -->
    <meta http-equiv="Content-Security-Policy" content={CSP_META_CONTENT} />

    <!-- Navigation port fix for development -->
    <script is:inline src="/js/navigation-fix.js"></script>

    <!-- Development warnings suppressor -->
    <script is:inline src="/js/dev-warnings-suppressor.js"></script>

    <!-- Rating and progress bar handler -->
    <script is:inline src="/js/rating-handler.js"></script>

    <!-- Google Analytics and Search Console integration - ALWAYS include, not just in PROD -->
    <AnalyticsHead />

    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <link rel="icon" type="image/x-icon" href="/favicon.ico" />
    <link rel="apple-touch-icon" href="/assets/favicon.svg" />

    <!-- Additional meta tags for SEO -->
    <meta name="robots" content="index, follow" />
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:type" content="website" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content={title} />
    <meta name="twitter:description" content={description} />

    <!-- Additional head content -->
    <slot name="head" />
  </head>

  <body class="smart-page-layout">
    <!-- Header Navigation Component -->
    <HeaderNavigation />

    <!-- Smart Breadcrumb Navigation -->
    <BreadcrumbNavigation breadcrumbs={breadcrumbs} />

    <!-- Main Content Area -->
    <main id="main-content" class="smart-main-content vegas-bg-premium" role="main">
      <!-- Vegas Animated Gradient Background -->
      <div class="vegas-animated-blobs">
        <div class="vegas-blob vegas-blob-gold"></div>
        <div class="vegas-blob vegas-blob-red"></div>
        <div class="vegas-blob vegas-blob-purple"></div>
      </div>

      <!-- Content Slot -->
      <div class="content-wrapper">
        <slot />
      </div>
    </main>

    <!-- Comprehensive Footer Component -->
    <FooterSection />
  </body>
</html>

<!-- Styles moved to src/styles/components/simple-page-layout.css -->
